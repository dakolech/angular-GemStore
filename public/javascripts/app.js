// Generated by CoffeeScript 1.7.1
(function() {
  var app;

  app = angular.module('store', ['store-products']);

  app.controller('StoreController', function($scope, $http) {
    $scope.formData = {};
    $scope.formReview = {};
    $scope.formImage = {};
    $http.get('/api/products').success(function(data) {
      $scope.products = data;
      console.log(data);
    }).error(function(data) {
      console.log('Error: ' + data);
    });
    $scope.createProduct = function() {
      $scope.formData.what = 'create';
      $http.post('/api/products', $scope.formData).success(function(data) {
        $scope.formData = {};
        $scope.products = data;
        console.log(data);
      }).error(function(data) {
        console.log('Error: ' + data);
      });
    };
    $scope.deleteProduct = function(id) {
      if (confirm("Are you sure to delete this product?")) {
        $http["delete"]('/api/products/' + id).success(function(data) {
          $scope.products = data;
          console.log(data);
        }).error(function(data) {
          console.log('Error: ' + data);
        });
      }
    };
    $scope.startEditProduct = function(id) {
      $scope.formData.editing = true;
      $scope.formData.what = 'edit';
      $scope.formData.id = id;
      $http.post('/api/products/', $scope.formData).success(function(data) {
        $scope.products = data;
        console.log(data);
      }).error(function(data) {
        console.log('Error: ' + data);
      });
    };
    $scope.stopEditProduct = function(id) {
      $scope.formData.editing = false;
      $scope.formData.what = 'edit';
      $scope.formData.id = id;
      $http.post('/api/products/', $scope.formData).success(function(data) {
        $scope.products = data;
        console.log(data);
      }).error(function(data) {
        console.log('Error: ' + data);
      });
    };
    $scope.addReview = function(product) {
      var localReview;
      $scope.formReview.id = product._id;
      $scope.formReview.what = 'addReview';
      localReview = $scope.formReview;
      console.log(localReview);
      $http.post('/api/products/', $scope.formReview).success(function(data) {
        product.reviews.push(localReview);
        console.log(data);
      }).error(function(data) {
        console.log('Error: ' + data);
      });
      $scope.formReview = {};
    };
    $scope.imagesChanged = function(elm) {
      $scope.files = elm.files;
      $scope.$apply();
    };
    $scope.addImages = function(id) {
      var element, fd, index, _i, _len, _ref;
      _ref = $scope.files;
      for (index = _i = 0, _len = _ref.length; _i < _len; index = ++_i) {
        element = _ref[index];
        console.log(id);
        fd = new FormData();
        fd.append("file", $scope.files[index]);
        fd.append("id", id);
        console.log(id);
        $http.post('/api/images/', fd, {
          withCredentials: true,
          headers: {
            'Content-Type': void 0
          },
          transformRequest: angular.identity
        }).success(function(data) {
          $scope.products = data;
          console.log(data);
        }).error(function(data) {
          console.log('Error: ' + data);
        });
      }
      $scope.formData = {};
      $scope.files = {};
    };
    $scope.deleteImage = function(id, name) {
      if (confirm("Are you sure to delete this image?")) {
        $scope.formImage.id = id;
        $scope.formImage.name = name;
        $scope.formImage.what = 'deleteImage';
        $http.post('/api/products/', $scope.formImage).success(function(data) {
          $scope.products = data;
          console.log(data);
        }).error(function(data) {
          console.log('Error: ' + data);
        });
        $scope.formImage = {};
      }
    };
  });

  app.controller("PanelController", function($scope, $http) {
    $scope.tab = 1;
    $scope.selectTab = function(setTab) {
      $scope.tab = setTab;
    };
    $scope.isSelected = function(checkTab) {
      return $scope.tab === checkTab;
    };
  });

  app.controller("AdminEditPanelController", function($scope, $http) {
    $scope.tab = 1;
    $scope.selectTab = function(setTab) {
      $scope.tab = setTab;
    };
    $scope.isSelected = function(checkTab) {
      return $scope.tab === checkTab;
    };
  });

  app.controller('GalleryController', function() {
    this.current = 0;
    this.setCurrent = function(imageNumber) {
      this.current = imageNumber || 0;
    };
  });

}).call(this);
